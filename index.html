<html>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    circle {
      fill: lightblue;
      stroke: black;
    }
  </style>

  <body onload="init()">
    <svg width="300" height="300"></svg>

    <script>
      async function init() {
        data = await d3.csv("https://flunky.github.io/cars2017.csv");
        //console.log(data);

        // set the dimensions and margins of the graph
        let margin = { top: 50, right: 50, bottom: 50, left: 50 };
        let width = 300 - margin.left - margin.right;
        let height = 300 - margin.top - margin.bottom;

        let svg = d3.select("svg");

        let x = d3.scaleLog().domain([10, 150]).range([0, width]);
        let y = d3.scaleLog().domain([10, 150]).range([height, 0]);

        let g = svg
          .append("g")
          .attr(
            "transform",
            "translate(" + margin.left + "," + margin.top + ")"
          );

        // Add dots
        g.selectAll("dot")
          .data(data)
          .enter()
          .append("circle")
          .attr("cx", function (d) {
            return x(parseInt(d.AverageCityMPG));
          })
          .attr("cy", function (d) {
            return y(parseInt(d.AverageHighwayMPG));
          })
          .attr("r", function (d) {
            return 2 + parseInt(d.EngineCylinders);
          });

        // Add Y axis
        g.append("g")
          .attr("transform", "translate(" + 50 + "," + 50 + ")")
          .call(
            d3
              .axisLeft(y)
              .tickValues([10, 20, 50, 100])
              .tickFormat(d3.format("~s"))
          );

        // Add X axis
        g.append("g")
          .attr("transform", "translate(" + 50 + "," + 250 + ")")
          .call(
            d3
              .axisBottom(x)
              .tickValues([10, 20, 50, 100])
              .tickFormat(d3.format("~s"))
          );
      }
    </script>
  </body>
</html>
